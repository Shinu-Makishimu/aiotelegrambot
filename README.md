# Бот -  с функцией поиска отелей в мессенджере Telegram



## Особенности

This bot can:
* Искать отели по самой низкой или высокой цене;
* Искать отели по соотношению цена/расстояние от центра города;  
* задавать количество выводимых отелей;
* задавать количество выводимых фото найденных отелей
* задавать диапазон цен.
* хранить и предоставлять для просмотра и повторного использования историю запросов пользователя

## Особености функционирования.

* Этот бот демонстрация работы aiogram
* 

## Requirements

* Python 3.9+
* [aiogram]() – Python Telegram Bot API
* [requests](https://github.com/psf/requests) - библиотека requests
* [redis](https://redis.io/) - хранилище поисковых параметров текущей сессии пользователя
* [sqlite3](https://www.sqlite.org/) - хранилище параметров языка, валюты и истории поисковых запросов пользователя
* [loguru](https://github.com/Delgan/loguru) Логирование выполняемых команд и функций бота.

Вы можете установить все зависимости, выполнив следующую команду: `pip install -r requirements.txt`

Для корректной работы требуется запущенный Redis server версии не ниже 3.0.504.



## Команды бота

* `/start` - запуск бота, выполняется автоматически при подключении к боту.
* `/help` - список команд и их описание
* `/lowprice` - топ дешевых отелей
* `/highprice` - топ дорогих отелей
* `/bestdeal` - лучшие предложения
* `/settings` - меню с настройками  
* `/history` - меню с историей запросов, при её наличии  


## Как работать с ботом

Список всех команд, поддерживаемых ботом, можно посмотреть по команде `/help`


##Команда '/history'
При наличии отсутствия поисковых запросов в базе, бот ответит

![нет истории](img/nodata.png)

Если запросы в истории есть, бот предложит выбрать один из запросов что бы увидеть дополнительную информацию о запросе

![есть история ](img/history.png)

что бы увидеть подробности кликните на соответствующую кнопку.

![пример истории](img/history2.png)

далее бот предложит повторить поиск или вернуться назад.



Далее приведена инструкция по работе с ботом. При ошибочном вводе бот выведет соответствующее сообщение и попросит ввести значение повторно.

### Топ дешевых отелей

1. Введите команду `/lowprice`. Бот запросит город, в котором вы хотите искать отели.
2. Введите название населенного пункта. Бот выполнит запрос к hotels api и выведет список локаций, названия которых похожи на введенный город. 
Так же будет доступна кнопка отказа от предложенных результатов. При нажатии на неё (а так же при отсутствии результатов 
поиска) бот попросит ввести название города снова. Если по запросу будет найден только один результат, бот без вопросов перейдет к следующему пункту опроса.
   
Ответ на запрос "омск":

![Локации](img/locations.png)
   
3. Выберите один из предложенных вариантов, наиболее подходящих вашему запросу.
4. Бот запросит количество отелей, которые вы хотите вывести в качестве результата. Введите количество отелей. 
5. Бот запросит количество фотографий которое должно быть выведено к каждому отелю.
6. Бот покажет календарь и предложит выбрать дату заезда.

**Порядок выбора:** Сначала год, потом месяц, потом день.

Календарь заезда:

![календарь](img/calendar.png)

**Внимание!** Дата заезда должна быть не меньше завтрашнего дня.

6.1 бот покажет календарь снова и предложит выбрать дату выезда. 

**Внимание!** дата выезда должна быть не меньше даты заезда. 
В случае некорректного ввода, бот укажет на ошибку и предложит ввести даты снова, начиная с даты заезда.

Календарь выезда:

![календарь](img/calendar2.png)

7. Бот выполнит следующий запрос к hotels api и выведет список отелей с указанием названия, класса, цены, адреса, 
расстояния от центра и ссылку на расположение отеля на картах google.

Пример результата:

![Отель](img/hotel.png)

8. Бот задаст вопрос о сохранении результатов поиска. При согласии бот сохранит вашу историю в базе данных, 
при отказе параметры запроса будут удалены немедленно

![сохранение](img/save.png)


### Топ дорогих отелей

1. Для получения списка самых дорогих отелей введите команду `/highprice`и выполните пункты 2 - 8 из инструкции выше для топа дешевых отелей

### Лучшие предложения

1. Введите команду `/bestdeal`. Выполните пункты 2-6 из инструкции выше для топа дешевых отелей.
2. Бот запросит радиус поиска от центра города в километрах. Ввод должен быть целым положительным числом. 
Внимание! Расстояние от центра города для отеля выдаётся API hotels.com и соответствие действительности **НЕ ГАРАНТИРУЕТСЯ**
3. Введите минимальную и максимальную цену через пробел. Ввод должен содержать только два числа через пробел без символов или букв.
4. Бот выполнит следующий запрос к hotels api и выведет список отелей с указанием названия, класса, цены, адреса, 
расстояния от центра и ссылку на расположение отеля на картах google.

### Рекомендации 

1. Название города должно состоять только из букв русского или английского алфавита и символа дефис.
2. Диапазон цен представляет собой два целых положительных числа, разделенных пробелом, написанных в одну строку.
3. Максимальное расстояние от центра города должно быть написано в виде положительного целого числа.
4. Количество выводимых отелей — целое положительное число. Максимальное возможное количество - 20, минимальное 1
5. Количество фотографий отеля — целое положительное число. Максимально возможное количество - 5, минимальное - 0
